<!doctype html><html><head><meta charset="UTF-8"><link rel='stylesheet' href='../shared/styles.css' /><script src="../shared/script.js"></script></head><body class="header">

  <h2>Console Stress test</h2>
  <p>Click the buttons below to spam the console</p>

  <button id="do-logs">LOL With Objects (Lots Of Logs)</button>
  <button id="do-logs-no-obj">LOL Without Objects (Lots Of Logs)</button>
  <button id="do-logs-repeats">Lots of Repeats</button>
  <button id="do-logs-groups">Lots of Groups</button>
  <button id="stream-logs">Streaming logs (Press 'T' key)</button>

  <div id="streaming-info"></div>
  <ol id="logs"></ol>

  <style type="text/css">body { min-height: 2000px; }</style>

  <script>

  var i = 0;
  var BULK_COUNT = 10000;
  var includeObj = false;

  function doLogs() {
    var totalStartTime = performance.now();
    var results = [];
    for (i = 0; i < BULK_COUNT; i++) {
      var startTime = performance.now();
      a();
      if (i % 2) {
        window.scrollTo(0, 1000);
      } else {
        window.scrollTo(0, 0);
      }
      var endTime = performance.now();
      results.push(endTime - startTime);
    }

    var totalEndTime = performance.now();
    console.log("Total time: " + (totalEndTime - totalStartTime));

    var logs = document.querySelector("#logs");
    results.forEach(function(result) {
      var li = document.createElement("li");
      li.textContent = result.toFixed(4) + "milliseconds";
      logs.appendChild(li);
    });

  }
  document.querySelector("#do-logs-no-obj").onclick = function() {
    includeObj = false;
    doLogs();
  };
  document.querySelector("#do-logs").onclick = function() {
    includeObj = true;
    doLogs();
  }
  document.querySelector("#do-logs-repeats").onclick = function() {
    for (i = 0; i < BULK_COUNT; i++) {
      console.log("Repeated message");
    }
  }
  document.querySelector("#do-logs-groups").onclick = function() {
    console.group("Big1");
    for (i = 0; i < 1000; i++) {
      console.log("Big1, message " + i);
    }
    console.groupEnd("Big1");
    console.group("Big2");
    for (i = 0; i < 1000; i++) {
      console.log("Big2, message " + i);
    }
    console.groupEnd("Big2");
    console.groupCollapsed("Big3");
    for (i = 0; i < 1000; i++) {
      console.log("Big3, message " + i);
    }
    console.groupEnd("Big3");
  }

  function a() { b() }
  function b() { c() }
  function c() { d() }
  function d() { e() }
  function e() { f() }
  function f() { g() }
  function g() { h() }
  function h() {
    if (includeObj) {
      var foo = { bar: { baz: true }};
      foo[i] = i;
      console.log("Log number -> ", i, foo);
    } else {
      console.log("Log number -> ", i);
    }
  }


  var print = false;
  var last = 0;
  document.querySelector("#stream-logs").onclick = function() {
    print = !print;
    last = now();
  }
  var streamingInfo = document.getElementById("streaming-info");
  var logs = document.getElementById("logs");
  var avgRAF = 0;

  function now() { return performance.now(); }

  function test(fps) {
      var interval = Math.floor(1000/fps);
      function cb() {
        if (print) {
          var start = now();
          var since = start - last;
          if (!avgRAF) { avgRAF = since; }
          else { avgRAF = avgRAF * .99 + since * .01; }
          var s = "since last: " + since +
              " wanted: " + interval + " time: " + start;
          logs.innerHTML =
              s + "<br>" + logs.innerHTML.substring(0, 10000);
          console.log(s);
          streamingInfo.textContent = "rolling average from last 100 rAF: " +
            Math.round(avgRAF) + "ms";
          last = start;
        }
        requestAnimationFrame(cb);
      }
      cb();
  }

  window.addEventListener("keydown", function (evt) {
      if (evt.keyCode == "T".charCodeAt(0)) print = !print;
  });

  test(32);


  </script>

</body></html>